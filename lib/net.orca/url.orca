using strings;
using __clib__;


def escape := __clib__.stringutil.url_escape;
def unescape := __clib__.stringutil.url_unescape;


def _parse(src)
{
	param = {,};

	toks = src.split('&');
	for tok in toks {
		kv = tok.split('=');
		if kv.size() > 1 {
			key = ..unescape(kv[0]);
			value = ..unescape(kv[1]);
			param[key] = value;
		}
		else {
			key = ..unescape(kv[0]);
			param[key] = nil;
		}
	}

	return param;
}


def compose(param)
{
	kvs = [];
	for k, v in param {
		key = ..escape(k);
		value = ..escape(v);
		kvs.push_back('%s=%s' % (key, value));
	}

	return strings.join('&', kvs...);
}

